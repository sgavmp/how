<!DOCTYPE html>
<html lang="en">
<head th:include="base :: head">
</head>
<body>
	<header th:include="base :: header"> </header>
	<main class="container">
		<div class="row">
			<div class="col-lg-12bhoechie-tab-container">
				<div class="col-lg-2 bhoechie-tab-menu">
					<div class="list-group">
						<a th:href="@{/measure/trello}" href="#"
							th:class="((${app}=='trello')?'active ':'') + 'list-group-item text-center'"
							class="list-group-item active text-center">
							<h4 class="fa fa-trello"></h4> <br />Trello
						</a> <a th:href="@{/measure/github}"
							th:class="((${app}=='github')?'active ':'') + 'list-group-item text-center'"
							href="#" class="list-group-item text-center">
							<h4 class="fa fa-github"></h4> <br />GitHub
						</a>
					</div>
				</div>
				<div class="col-lg-10 bhoechie-tab">
					<!-- trello section -->
					<div
						th:class="((${app}=='trello')?'active ':'') + 'bhoechie-tab-content'"
						class="bhoechie-tab-content active">
						<a class="active" type="button" th:text="#{web.apps.createmeasure}"
							data-toggle="modal" data-target="#createTrello">Crear medida</a>
						<div th:if="${measuresTrello}" class="col-lg-12">
							<div class="panel-group" id="accordion">
								<div th:each="measure,count : ${measuresTrello}"
									class="panel panel-default">
									<div class="panel-heading">
										<h4 class="panel-title">
											<a data-toggle="collapse" data-parent="#accordion"
												th:href="'#collapse' + ${count.count}" href="#collapse-"
												th:text="${measure.name}"> Medidas del tablero ISPP </a>
										</h4>
									</div>
									<div th:id="'collapse' + ${count.count}" id="collapseOne"
										class="panel-collapse collapse">
										<div class="panel-body">
											<div th:id="${measure.id}" id="container"
												style="min-width: 600px; width: 100%; height: 400px; margin: 0 auto"></div>
											<a class="btn btn-danger"
												th:href="@{'/measure/trello/delete/' + ${measure.id}}"
												href="/measure/trello/delete/34234">Delete</a>
										</div>
									</div>
								</div>
	
							</div>
						</div>
						<div th:if="!${measures}" th:text="#{web.apps.notmeasure}"></div>
						<!-- Modal -->
						<div class="modal fade" id="createTrello" tabindex="-1"
							role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal"
											aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="myModalLabel"
											th:text="#{web.apps.create.trello}">Login</h4>
									</div>
									<div class="modal-body">
										<a th:each="board : ${boards}"
											th:href="@{'/measure/trello/create/board/' + ${board.id}}"
											th:text="${board.name}">Nombre tablero</a>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default"
											data-dismiss="modal" th:text="#{web.main.login.modal.close}">Close</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- github section -->
					<div
						th:class="((${app}=='github')?'active ':'') + 'bhoechie-tab-content'"
						class="bhoechie-tab-content">
						<a class="btn btn-theme" type="button"
							th:text="#{web.apps.createmeasure}" data-toggle="modal"
							data-target="#createGithub">Crear medida</a>
						<div th:if="${measuresGithub}" class="col-lg-12">
							<div class="panel-group" id="accordion">
								<div th:each="measure,count : ${measuresGithub}"
									class="panel panel-default">
									<div class="panel-heading">
										<h4 class="panel-title">
											<a data-toggle="collapse" data-parent="#accordion"
												th:href="'#collapse' + ${count.count}" href="#collapse-"
												th:text="${measure.name}"> Medidas del tablero ISPP </a>
										</h4>
									</div>
									<div th:id="'collapse' + ${count.count}" id="collapseOne"
										class="panel-collapse collapse">
										<div class="panel-body">
											<div th:id="${measure.id}" id="container"
												style="min-width: 600px; width: 100%; height: 400px; margin: 0 auto"></div>
											<a class="btn btn-danger"
												th:href="@{'/measure/trello/delete/' + ${measure.id}}"
												href="/measure/trello/delete/34234">Delete</a>
										</div>
									</div>
								</div>
	
							</div>
						</div>
						<div th:if="!${measures}" th:text="#{web.apps.notmeasure}"></div>
						<!-- Modal -->
						<div class="modal fade" id="createGithub" tabindex="-1"
							role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal"
											aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="myModalLabel"
											th:text="#{web.apps.create.github}">Login</h4>
									</div>
									<div class="modal-body">
										<a th:each="repo : ${repos}"
											th:href="@{'/measure/github/create/repo/' + ${repo.repoName}}"
											th:text="${repo.repoName}">Nombre repositorio</a><br />
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default"
											data-dismiss="modal" th:text="#{web.main.login.modal.close}">Close</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	<footer th:include="base :: footer"> </footer>
	<script th:each="measure : ${measures}" th:inline="javascript">
				$(function () {
					/*<![CDATA[*/
	        		var options = {
						colors: ['#2f7ed8', '#0d233a', '#8bbc21', '#910000', '#1aadce', 
						         '#492970', '#f28f43', '#77a1e5', '#c42525', '#a6c96a'],
			            chart: {
			            	renderTo: [[${measure.id}]],
			                type: 'spline'
			            },
			            title: {
			                text: 'Tareas del tablero ' + [[${measure.name}]] 
			            },
			            subtitle: {
			                text: 'Evolución historica'
			            },
			            xAxis: {
			                type: 'datetime',
			                dateTimeLabelFormats: { // don't display the dummy year
			                	day: '%e-%b-%Y',
			                },
			                title: {
			                    text: 'Fecha'
			                }
			            },
			            yAxis: {
			                title: {
			                    text: 'Numero de tareas'
			                },
			                min: 0
			            },
			            tooltip: {
			                headerFormat: '<b>{series.name}</b><br>',
			                pointFormat: '{point.x:%H:%M %e-%b-%Y}: {point.y} Cards'
			            },
	
			            series: []
			        };
                    $.getJSON([[@{'http://localhost:8080/measure/trello/data/'+ ${measure.id}+'/json'}]], function(data) {
                    	 $.each(data, function(key,value) {
                             var series = { data: []};
                             $.each(value, function(key,val) {
                                 if (key == 'name') {
                                     series.name = val;
                                 }
                                 else if (key == 'color') {
                                	 series.color = val;
                                 }
                                 else
                                 {
                                     $.each(val, function(key,val) {
                                         var d = String(val).split(",");
                                         var x = Date.UTC(d[0],d[1],d[2],d[3],d[4]);
                                         series.data.push([x,parseInt(d[5])]);
                                     });
                                 }
                             });
                        options.series.push(series);
                        var chart = new Highcharts.Chart(options);
						});
                    });
			    });
				/*]]>*/
			</script>
</body>
</html>
